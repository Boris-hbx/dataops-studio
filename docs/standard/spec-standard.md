# Spec 规范

> 所有功能开发任务的 Spec 必须遵循本规范。

## Spec 文件位置

```
docs/spec/SPEC-{序号}-{功能名}.md
```

## 必要章节

每个 Spec 必须包含以下章节，缺一不可：

| # | 章节 | 内容 | 负责角色 |
|---|------|------|---------|
| 1 | 问题陈述（Why） | 为什么要做这件事，解决什么痛点 | PO |
| 2 | 目标与成功标准（DoD） | 做到什么程度算完成，必须可验证 | PO |
| 3 | 非目标（Out of Scope） | 明确不做什么，防止 scope creep | PO |
| 4 | 技术方案（How） | 架构设计、模块划分、API 契约、数据模型 | 架构师 |
| 5 | 交互设计（UX） | 组件树、状态流转、页面状态方案 | UX 专家 |
| 6 | 风险清单与应对 | 按维度列出风险 + 优先级 + 应对策略 | Challenger |
| 7 | 决策记录（Decision Log） | 关键决策 + rationale，不允许只给结论 | 全员 |

## DoD 书写规范

- **必须可验证**：不写"用户体验好"，写"列表 1 秒内加载完成"
- **必须可测试**：每条 DoD 对应至少一个可执行的检查方式
- **示例**：
  - `GET /api/pipelines` 返回 200 + JSON 数组
  - 空数据时页面显示 Empty 组件
  - lint + test 全部通过

## 风险清单格式

```markdown
| 维度 | 风险描述 | 优先级 | 应对策略 | 决策 |
|------|---------|--------|---------|------|
| API 契约 | 前后端字段类型不一致 | P0 | 定义 TypeScript interface + Python Pydantic model 对齐 | 接受 |
| 安全 | 用户输入未校验 | P0 | 前端 Form rules + 后端 Pydantic 双重校验 | 接受 |
| 性能 | 大数据量列表渲染卡顿 | P1 | 分页 + 虚拟滚动 | 降级为 P2，先分页 |
```

优先级定义：
- **P0** — 必须解决，阻塞上线
- **P1** — 应该解决，不解决需记录理由
- **P2** — 可接受的风险，记录即可

## 决策记录格式

```markdown
| 决策项 | 选项 | 结论 | 理由 |
|--------|------|------|------|
| 状态管理方案 | A: useState B: Redux C: Zustand | A: useState | 页面简单，无跨组件共享状态需求 |
| API 分页方式 | A: offset B: cursor | A: offset | 数据量 <1000，offset 实现简单 |
```

## Spec 模板

```markdown
## Spec: {功能名}

**编号**: SPEC-{序号}
**状态**: Draft / Review / Approved / Implemented
**日期**: YYYY-MM-DD

### 一、问题陈述（Why）
{为什么要做}

### 二、目标与成功标准（DoD）
- [ ] {可验证的标准 1}
- [ ] {可验证的标准 2}

### 三、非目标（Out of Scope）
- {不做什么 1}
- {不做什么 2}

### 四、技术方案（How）
{架构设计、API 契约、数据模型}

### 五、交互设计（UX）
{组件树、状态流转、页面状态方案}

### 六、风险清单与应对
| 维度 | 风险描述 | 优先级 | 应对策略 | 决策 |
|------|---------|--------|---------|------|

### 七、决策记录
| 决策项 | 选项 | 结论 | 理由 |
|--------|------|------|------|
```
